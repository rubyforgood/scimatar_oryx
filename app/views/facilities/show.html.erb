<p id="notice"><%= notice %></p>

<p>
  <strong>Name:</strong>
  <%= @facility.name %>
</p>

<%= image_tag @facility.pictures.first.image.url(:large) if @facility.pictures.first %>

<% if current_user.site_admin? || @facility_user.facility_id === @facility.id%>
<%= link_to 'Edit', edit_facility_path(@facility) %> |
<% end %>

<%= link_to 'Back', facilities_path %>

<h2>Animals</h2>
<%= link_to 'Add Animal', new_animal_path(facility_id: @facility.id) %>
<%= render @facility.animals %>

<%= chart(:PieChart, [['Gender', 'Total']]+@facility.animals.reduce(Hash.new(0)){ |s, e| s[e.gender] += 1; s}.to_a ) %>

<%= chart(:PieChart, [['Species', 'Total']]+@facility.animals.reduce(Hash.new(0)){ |s, e| s[e.species.name] += 1; s}.to_a ) %>

<%= chart(:Histogram, [['Animal', 'Age']]+@facility.animals.map{ |e| [e.name, e.age]}, title: "Age distribution") %>

TODO: geo chart still has fake data
<%= chart(:GeoChart, [['State', 'Animals'],['US-IL', 2], ['US-IN', 5],['US-IA', 1],['US-TX', 2], ['US-CA', 7],['US-VA', 6]], region: "US", resolution: "provinces") %>
